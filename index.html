<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhusLand Bestellrechner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            color: #334155;
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        body.dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #cbd5e1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        body.dark .card {
            background: rgba(30, 41, 59, 0.9);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        
        .header-gradient {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1rem;
            border-radius: 1rem 1rem 0 0;
        }
        
        body.dark .header-gradient {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #7c3aed 100%);
        }
        
        .category-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        body.dark .category-card {
            background: #1e293b;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        
        .category-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 600;
            text-align: center;
        }
        
        body.dark .category-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #1e40af 100%);
        }
        
        .item-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s;
        }
        
        body.dark .item-row {
            border-bottom: 1px solid #374151;
        }
        
        .item-row:hover {
            background-color: #f8fafc;
        }
        
        body.dark .item-row:hover {
            background-color: #2d3748;
        }
        
        .item-row:last-child {
            border-bottom: none;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            background: #f1f5f9;
        }
        
        body.dark .quantity-control {
            background: #374151;
        }
        
        .quantity-control button {
            background: transparent;
            border: none;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 1.125rem;
            line-height: 1;
            color: #475569;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        body.dark .quantity-control button {
            color: #d1d5db;
        }
        
        .quantity-control button:hover {
            background: #e2e8f0;
        }
        
        body.dark .quantity-control button:hover {
            background: #4b5563;
        }
        
        .quantity-control input {
            width: 3rem;
            text-align: center;
            background: white;
            border: none;
            padding: 0.5rem 0.25rem;
            font-weight: 500;
            color: #1e293b;
        }
        
        body.dark .quantity-control input {
            background: #1f2937;
            color: #f8fafc;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #374151 0%, #6b7280 100%);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            color: white;
            font-size: 12px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            z-index: 2;
        }
        
        input:checked + .theme-slider {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(30px);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            color: #334155;
        }
        
        body.dark .modal-content {
            background: #1e293b;
            color: #cbd5e1;
        }
        
        .settings-tab {
            padding: 1rem 1.5rem;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            background: transparent;
            border: none;
            color: #64748b;
        }
        
        .settings-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }
        
        body.dark .settings-tab.active {
            color: var(--primary-dark);
            border-bottom-color: var(--primary-dark);
        }
        
        .editor-tab {
            display: none;
        }
        
        .editor-tab.active {
            display: block;
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 1.7s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .grid-responsive {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .grid-responsive {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            .action-buttons > * {
                width: 100%;
            }
        }
        
        .price-tag {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .total-price {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Header -->
            <div class="header-gradient">
                <div class="flex flex-col items-center mb-2">
                    <div class="logo mb-2">
                        <div class="logo-icon">🍕</div>
                        <span>KhusLand</span>
                    </div>
                    <div class="total-price">
                        <span>💰 Gesamtpreis:</span>
                        <span id="totalPrice">0$</span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <div></div> <!-- Platzhalter für Symmetrie -->
                    
                    <div class="flex items-center gap-4">
                        <div class="theme-toggle">
                            <input type="checkbox" id="themeToggle">
                            <label class="theme-slider">
                                <span>🌙</span>
                                <span>☀️</span>
                            </label>
                        </div>
                        <button id="settingsButton" class="btn btn-secondary">
                            <span>⚙️</span>
                            Einstellungen
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="p-6">
                <div id="categoriesGrid" class="grid-responsive mb-8">
                    <!-- Categories will be populated by JavaScript -->
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons flex justify-between gap-4 mt-6">
                    <button id="resetButton" class="btn btn-danger">
                        <span>🗑️</span>
                        Alle zurücksetzen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="header-gradient rounded-t-lg">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span>⚙️</span>
                    Einstellungen
                </h3>
            </div>
            
            <div class="p-6">
                <div id="passwordSection">
                    <label for="passwordInput" class="block text-sm font-medium mb-2">Passwort für Admin-Bereich:</label>
                    <input type="password" id="passwordInput" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Passwort eingeben">
                    <button id="loginButton" class="mt-4 w-full btn btn-primary">Anmelden</button>
                    <p id="passwordError" class="text-red-500 text-sm mt-2 hidden">Falsches Passwort!</p>
                </div>
                
                <div id="editSection" class="hidden">
                    <div class="flex border-b border-gray-200 dark:border-gray-700 mb-4">
                        <button class="settings-tab active" data-editor="item">Artikel</button>
                        <button class="settings-tab" data-editor="category">Kategorien</button>
                        <button class="settings-tab" data-editor="general">Allgemein</button>
                    </div>

                    <div id="itemEditor" class="editor-tab active">
                        <h4 class="text-lg font-bold mb-3">Artikel bearbeiten</h4>
                        <div id="itemEditorContent"></div>
                    </div>

                    <div id="categoryEditor" class="editor-tab">
                        <h4 class="text-lg font-bold mb-3">Kategorien bearbeiten</h4>
                        <div id="categoryEditorContent" class="space-y-3 mb-6"></div>
                        <div class="border-t border-gray-300 dark:border-gray-600 pt-4">
                            <h5 class="font-semibold mb-2">Neue Kategorie hinzufügen:</h5>
                            <input type="text" id="categoryName" placeholder="Kategoriename" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 mb-2">
                            <button id="saveCategory" class="w-full btn btn-primary">Hinzufügen</button>
                        </div>
                    </div>
                    
                    <div id="generalSettingsEditor" class="editor-tab">
                        <h4 class="text-lg font-bold mb-3">Allgemeine Einstellungen</h4>
                        <div class="mb-4">
                            <label for="titleInput" class="block text-sm font-medium mb-2">Titel ändern:</label>
                            <input type="text" id="titleInput" placeholder="Neuer Titel" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600" value="KhusLand">
                        </div>
                        <button id="saveGeneralSettings" class="w-full btn btn-primary">Speichern</button>
                    </div>

                    <button id="closeSettings" class="mt-6 w-full btn btn-secondary">Schließen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="modal-overlay hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col items-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300">Lade Daten...</p>
        </div>
    </div>

    <script>
        // Datenmodell
        const defaultPreise = {
            beluga: { name: 'Beluga Kaviar', price: 300, category: 'SPEISEN', id: 'beluga' },
            doener: { name: 'Fischdöner', price: 175, category: 'SPEISEN', id: 'doener' },
            bowl: { name: 'Seafood Bowl', price: 175, category: 'SPEISEN', id: 'bowl' },
            lobster: { name: 'Lobster Teller', price: 175, category: 'SPEISEN', id: 'lobster' },
            lachs: { name: 'Lachsnudeln', price: 140, category: 'SPEISEN', id: 'lachs' },
            fiji: { name: 'Fiji Wasser', price: 75, category: 'GETRÄNKE', id: 'fiji' },
            eistee: { name: 'Eistee Pfirsich', price: 75, category: 'GETRÄNKE', id: 'eistee' },
            slush: { name: 'Lake Slush', price: 75, category: 'GETRÄNKE', id: 'slush' },
            mojito: { name: 'Lake Mojito', price: 60, category: 'GETRÄNKE', id: 'mojito' },
            cola: { name: 'Cola Cherry', price: 60, category: 'GETRÄNKE', id: 'cola' },
            dom: { name: 'Dom Perignon', price: 400, category: 'ALKOHOL', id: 'dom' },
            jacky: { name: 'Jacky Cola', price: 300, category: 'ALKOHOL', id: 'jacky' },
            raki: { name: 'Yeni Raki', price: 200, category: 'ALKOHOL', id: 'raki' },
            kuchen: { name: 'Kuchen', price: 400, category: 'DESSERTS', id: 'kuchen' },
            pudding: { name: 'Pudding', price: 300, category: 'DESSERTS', id: 'pudding' },
            kekse: { name: 'Kekse', price: 300, category: 'DESSERTS', id: 'kekse' },
            rose: { name: 'Ecla Lune Rose 1L', price: 10000, category: 'PREMIUM', id: 'rose' },
            gold: { name: 'Ecla Lune Gold 6L', price: 35000, category: 'PREMIUM', id: 'gold' },
            gutschein: { name: 'Essens Gutschein', price: 1500, category: 'PREMIUM', id: 'gutschein' },
            vape: { name: 'Vape', price: 100, category: 'RAUCHWAREN', id: 'vape' }
        };

        let currentPreise = { ...defaultPreise };
        let categories = ['SPEISEN', 'GETRÄNKE', 'ALKOHOL', 'DESSERTS', 'PREMIUM', 'RAUCHWAREN'];
        let customTitle = 'KhusLand';

        // DOM-Elemente
        const elements = {
            themeToggle: document.getElementById('themeToggle'),
            categoriesGrid: document.getElementById('categoriesGrid'),
            settingsButton: document.getElementById('settingsButton'),
            resetButton: document.getElementById('resetButton'),
            settingsModal: document.getElementById('settingsModal'),
            passwordInput: document.getElementById('passwordInput'),
            loginButton: document.getElementById('loginButton'),
            passwordError: document.getElementById('passwordError'),
            editSection: document.getElementById('editSection'),
            closeSettings: document.getElementById('closeSettings'),
            totalPrice: document.getElementById('totalPrice'),
            itemEditorContent: document.getElementById('itemEditorContent'),
            categoryEditorContent: document.getElementById('categoryEditorContent'),
            categoryName: document.getElementById('categoryName'),
            saveCategory: document.getElementById('saveCategory'),
            titleInput: document.getElementById('titleInput'),
            saveGeneralSettings: document.getElementById('saveGeneralSettings')
        };

        // Initialisierung
        function init() {
            renderCalculatorInputs();
            setupEventListeners();
            applySavedTheme();
            berechne(); // Initiale Berechnung
        }

        // Event Listeners
        function setupEventListeners() {
            // Theme Toggle
            elements.themeToggle.addEventListener('change', toggleTheme);
            
            // Buttons
            elements.resetButton.addEventListener('click', resetRechner);
            elements.settingsButton.addEventListener('click', openSettings);
            
            // Settings Modal
            elements.closeSettings.addEventListener('click', closeSettings);
            elements.loginButton.addEventListener('click', checkPassword);
            
            // Editor tabs
            document.querySelectorAll('.settings-tab').forEach(button => {
                button.addEventListener('click', (e) => {
                    showEditor(e.target.dataset.editor);
                });
            });
            
            // Category editor
            elements.saveCategory.addEventListener('click', saveCategory);
            
            // General settings
            elements.saveGeneralSettings.addEventListener('click', saveGeneralSettings);
            
            // Close modal on outside click
            elements.settingsModal.addEventListener('click', (e) => {
                if (e.target === elements.settingsModal) {
                    closeSettings();
                }
            });
        }

        // Rendering
        function renderCalculatorInputs() {
            elements.categoriesGrid.innerHTML = '';
            
            categories.forEach(category => {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                categoryCard.innerHTML = `
                    <div class="category-header">${category}</div>
                    <div class="space-y-0"></div>
                `;
                elements.categoriesGrid.appendChild(categoryCard);

                const itemsContainer = categoryCard.querySelector('.space-y-0');
                const itemsInCategory = Object.values(currentPreise).filter(item => item.category === category);

                if (itemsInCategory.length === 0) {
                    itemsContainer.innerHTML = '<div class="item-row text-center text-gray-500 py-4">Keine Artikel</div>';
                } else {
                    itemsInCategory.forEach(item => {
                        const itemRow = document.createElement('div');
                        itemRow.className = 'item-row';
                        itemRow.innerHTML = `
                            <div class="flex flex-col"> 
                                <span class="font-medium">${item.name}</span>
                                <span class="price-tag">${item.price}$</span>
                            </div>
                            <div class="quantity-control">
                                <button data-id="${item.id}" data-action="decrease">-</button>
                                <input id="${item.id}" type="number" min="0" value="0">
                                <button data-id="${item.id}" data-action="increase">+</button>
                            </div>
                        `;
                        itemsContainer.appendChild(itemRow);
                    });
                }
            });
            
            // Event listeners für die Quantity-Buttons
            document.querySelectorAll('.quantity-control button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.target.dataset.id;
                    const action = e.target.dataset.action;
                    changeQuantity(id, action === 'increase' ? 1 : -1);
                    berechne(); // Gesamtpreis neu berechnen
                });
            });
            
            // Event listeners für die Inputs
            document.querySelectorAll('#categoriesGrid input[type="number"]').forEach(input => {
                input.addEventListener('input', berechne); // Gesamtpreis neu berechnen
            });
        }

        // Business Logic
        function changeQuantity(id, change) {
            const input = document.getElementById(id);
            if (input) {
                let currentValue = parseInt(input.value) || 0;
                currentValue += change;
                if (currentValue < 0) currentValue = 0;
                input.value = currentValue;
            }
        }

        // Gesamtpreis berechnen
        function berechne() {
            let summe = 0;
            
            for (const key in currentPreise) {
                const inputElement = document.getElementById(key);
                if (inputElement) {
                    const anzahl = parseInt(inputElement.value) || 0;
                    if (anzahl > 0) {
                        summe += anzahl * currentPreise[key].price;
                    }
                }
            }
            
            elements.totalPrice.textContent = `${summe}$`;
        }

        // Theme functions
        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function applySavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark');
                elements.themeToggle.checked = true;
            }
        }

        // Reset function
        function resetRechner() {
            if (confirm('Möchten Sie wirklich alle Eingaben zurücksetzen?')) {
                document.querySelectorAll('#categoriesGrid input[type="number"]').forEach(input => {
                    input.value = 0;
                });
                berechne(); // Gesamtpreis neu berechnen
            }
        }

        // Settings functions
        function openSettings() {
            elements.settingsModal.classList.remove('hidden');
        }

        function closeSettings() {
            elements.settingsModal.classList.add('hidden');
            elements.passwordSection.classList.remove('hidden');
            elements.editSection.classList.add('hidden');
            elements.passwordError.classList.add('hidden');
            elements.passwordInput.value = '';
        }

        function checkPassword() {
            const password = elements.passwordInput.value;
            // Einfaches Passwort für Demo-Zwecke
            if (password === 'admin123') {
                elements.passwordError.classList.add('hidden');
                elements.passwordSection.classList.add('hidden');
                elements.editSection.classList.remove('hidden');
                showEditor('item');
            } else {
                elements.passwordError.classList.remove('hidden');
            }
        }

        function showEditor(editorType) {
            document.querySelectorAll('.editor-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.settings-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(editorType + 'Editor').classList.add('active');
            document.querySelector(`[data-editor="${editorType}"]`).classList.add('active');
            
            if (editorType === 'item') {
                renderItemEditor();
            } else if (editorType === 'category') {
                renderCategoryEditor();
            } else if (editorType === 'general') {
                renderGeneralSettingsEditor();
            }
        }

        function renderItemEditor() {
            elements.itemEditorContent.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Kategorie auswählen:</label>
                    <select id="editorCategorySelect" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600">
                        ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>
                </div>
                <div id="editorItemsList" class="space-y-3 mb-6"></div>
                <div class="border-t border-gray-300 dark:border-gray-600 pt-4">
                    <h5 class="font-semibold mb-2">Artikel hinzufügen/bearbeiten:</h5>
                    <input type="hidden" id="editItemId">
                    <input type="text" id="itemName" placeholder="Artikelname" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 mb-2">
                    <input type="number" id="itemPrice" placeholder="Preis" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 mb-2">
                    <button id="saveItem" class="w-full btn btn-primary">Speichern</button>
                </div>
            `;
            
            document.getElementById('editorCategorySelect').addEventListener('change', updateEditorItemsList);
            document.getElementById('saveItem').addEventListener('click', saveItem);
            
            updateEditorItemsList();
        }

        function updateEditorItemsList() {
            const selectedCategory = document.getElementById('editorCategorySelect').value;
            const itemsListDiv = document.getElementById('editorItemsList');
            itemsListDiv.innerHTML = '';

            const itemsInCategory = Object.values(currentPreise).filter(item => item.category === selectedCategory);

            if (itemsInCategory.length === 0) {
                itemsListDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Keine Artikel in dieser Kategorie</p>';
            } else {
                itemsInCategory.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-3 rounded-lg';
                    div.innerHTML = `
                        <span>${item.name} (${item.price}$)</span>
                        <div>
                            <button class="edit-item-btn text-blue-500 hover:text-blue-700 mr-2" data-id="${item.id}">✏️</button>
                            <button class="delete-item-btn text-red-500 hover:text-red-700" data-id="${item.id}">🗑️</button>
                        </div>
                    `;
                    itemsListDiv.appendChild(div);
                });
                
                // Event listeners für Edit/Delete Buttons
                document.querySelectorAll('.edit-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        editItem(e.target.dataset.id);
                    });
                });
                
                document.querySelectorAll('.delete-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        deleteItem(e.target.dataset.id);
                    });
                });
            }
        }

        function saveItem() {
            const itemId = document.getElementById('editItemId').value;
            const itemName = document.getElementById('itemName').value.trim();
            const itemPrice = parseInt(document.getElementById('itemPrice').value);
            const itemCategory = document.getElementById('editorCategorySelect').value;

            if (!itemName || isNaN(itemPrice) || itemPrice <= 0) {
                alert('Bitte gültigen Namen und Preis eingeben.');
                return;
            }

            if (itemId && currentPreise[itemId]) {
                currentPreise[itemId].name = itemName;
                currentPreise[itemId].price = itemPrice;
                currentPreise[itemId].category = itemCategory;
            } else {
                const newId = 'item_' + Date.now();
                currentPreise[newId] = {
                    id: newId,
                    name: itemName,
                    price: itemPrice,
                    category: itemCategory
                };
            }

            updateEditorItemsList();
            document.getElementById('editItemId').value = '';
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            showNotification('Artikel gespeichert!');
        }

        function editItem(id) {
            const item = currentPreise[id];
            if (item) {
                document.getElementById('editItemId').value = item.id;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemPrice').value = item.price;
                document.getElementById('editorCategorySelect').value = item.category;
                document.getElementById('itemName').focus();
            }
        }

        function deleteItem(id) {
            if (confirm(`Sicher, dass du "${currentPreise[id].name}" löschen möchtest?`)) {
                delete currentPreise[id];
                updateEditorItemsList();
                showNotification('Artikel gelöscht!');
            }
        }

        function renderCategoryEditor() {
            elements.categoryEditorContent.innerHTML = '';
            
            categories.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-3 rounded-lg';
                div.innerHTML = `
                    <span>${cat}</span>
                    <div>
                        <button class="edit-category-btn text-blue-500 hover:text-blue-700 mr-2" data-category="${cat}">✏️</button>
                        <button class="delete-category-btn text-red-500 hover:text-red-700" data-category="${cat}">🗑️</button>
                    </div>
                `;
                elements.categoryEditorContent.appendChild(div);
            });
            
            // Event listeners
            document.querySelectorAll('.edit-category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    editCategory(e.target.dataset.category);
                });
            });
            
            document.querySelectorAll('.delete-category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    deleteCategory(e.target.dataset.category);
                });
            });
        }

        function saveCategory() {
            const categoryName = elements.categoryName.value.trim().toUpperCase();
            if (!categoryName) {
                alert('Bitte geben Sie einen Kategorienamen ein.');
                return;
            }

            if (categories.includes(categoryName)) {
                alert('Diese Kategorie existiert bereits.');
                return;
            }

            categories.push(categoryName);
            renderCategoryEditor();
            elements.categoryName.value = '';
            showNotification('Kategorie hinzugefügt!');
        }

        function editCategory(oldName) {
            const newName = prompt(`Neuen Namen für die Kategorie "${oldName}" eingeben:`, oldName);
            if (newName === null || newName.trim() === '') {
                return;
            }
            const trimmedNewName = newName.trim().toUpperCase();
            
            if (trimmedNewName === oldName) return;

            if (categories.includes(trimmedNewName)) {
                 alert('Eine Kategorie mit diesem Namen existiert bereits.');
                 return;
            }

            // Update category in items
            for (const itemId in currentPreise) {
                if (currentPreise[itemId].category === oldName) {
                    currentPreise[itemId].category = trimmedNewName;
                }
            }

            // Update categories array
            const index = categories.indexOf(oldName);
            if (index > -1) {
                categories[index] = trimmedNewName;
            }

            renderCategoryEditor();
            showNotification('Kategorie bearbeitet!');
        }

        function deleteCategory(categoryName) {
            const itemsInCategory = Object.values(currentPreise).filter(item => item.category === categoryName);
            if (itemsInCategory.length > 0) {
                alert(`Die Kategorie "${categoryName}" enthält noch Artikel und kann nicht gelöscht werden. Bitte löschen oder verschieben Sie die Artikel zuerst.`);
                return;
            }
            if (confirm(`Sicher, dass du die Kategorie "${categoryName}" löschen möchtest?`)) {
                categories = categories.filter(cat => cat !== categoryName);
                renderCategoryEditor();
                showNotification('Kategorie gelöscht!');
            }
        }

        function renderGeneralSettingsEditor() {
            elements.titleInput.value = customTitle;
        }

        function saveGeneralSettings() {
            const newTitle = elements.titleInput.value.trim();
            if (newTitle) {
                customTitle = newTitle;
                document.querySelector('.logo span').textContent = newTitle;
                document.title = newTitle + ' Bestellrechner';
                showNotification('Einstellungen gespeichert!');
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'copy-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
